require 'mkmf'
have = %w{
  OPENSSL_110_THREADING_API
  HMAC_CTX_COPY
  EVP_CIPHER_CTX_COPY
  BN_RAND_RANGE
  BN_PSEUDO_RAND_RANGE
  X509V3_EXT_NCONF_NID
  OBJ_NAME_DO_ALL_SORTED
  _ASSERT_H
  _OPENSSL_SSL_H
  _OPENSSL_CONF_API_H
  _SSL_LIBRARY_INIT
  _OPENSSL_SSL_H
  _ERR_PEEK_LAST_ERROR
  _ASN1_PUT_EOC
  _BN_MOD_ADD
  _BN_MOD_SQR
  _BN_MOD_SUB
  _CONF_GET1_DEFAULT_CONFIG_FILE
  _EVP_CIPHER_CTX_SET_PADDING
  _EVP_CIPHERFINAL_EX
  _EVP_CIPHERINIT_EX
  _EVP_DIGESTFINAL_EX
  _EVP_DIGESTINIT_EX
  _EVP_MD_CTX_CLEANUP
  _EVP_MD_CTX_CREATE
  _EVP_MD_CTX_DESTROY
  _EVP_MD_CTX_INIT
  _HMAC_CTX_CLEANUP
  _HMAC_CTX_INIT
  _PEM_DEF_CALLBACK
  PKCS5_PBKDF2_HMAC
  PKCS5_PBKDF2_HMAC_SHA1
  _RAND_EGD
  _X509V3_SET_NCONF
  _X509_CRL_ADD0_REVOKED
  _X509_CRL_SET_ISSUER_NAME
  _X509_CRL_SET_VERSION
  _X509_CRL_SORT
  _X509_NAME_HASH_OLD
  _SSL_SESSION_GET_ID
  _OPENSSL_CLEANSE
  _SSLV2_METHOD
  _SSLV2_SERVER_METHOD
  _SSLV2_CLIENT_METHOD
  _SSLV3_METHOD
  _SSLV3_SERVER_METHOD
  _SSLV3_CLIENT_METHOD
  _TLSV1_1_METHOD
  _TLSV1_1_SERVER_METHOD
  _TLSV1_1_CLIENT_METHOD
  _TLSV1_2_METHOD
  _TLSV1_2_SERVER_METHOD
  _TLSV1_2_CLIENT_METHOD
  _SSL_CTX_SET_NEXT_PROTO_SELECT_CB
  _SSL_SET_TLSEXT_HOST_NAME
  OPENSSL_ENGINE_H
  ENGINE_ADD
  ENGINE_LOAD_BUILTIN_ENGINES
  ENGINE_GET_DIGEST
  ENGINE_GET_CIPHER
  ENGINE_CLEANUP
  ENGINE_LOAD_DYNAMIC
  ENGINE_LOAD_CRYPTODEV
  ENGINE_LOAD_AESNI
  _DH_GENERATE_PARAMETERS_EX
  _DSA_GENERATE_PARAMETERS_EX
  _RSA_GENERATE_KEY_EX
  _OPENSSL_OCSP_H
  _EVP_CIPHER_CTX_FLAGS
  _ST_FLAGS
  EVP_CIPHER_CTX_ENGINE
  _ST_ENGINE
  _X509_ATTRIBUTE_SINGLE
  _ST_SINGLE
  _OPENSSL_FIPS
  _AUTHENTICATED_ENCRYPTION
}
$CFLAGS += " -I #{ENV['OPENSSL_INCLUDE']} #{have.map { |h| "-DHAVE_#{h}" }.join(' ')}"
$LIBS += " -l #{ENV['OPENSSL_LIB']}"
create_makefile('openssl')
